<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.yeongju.its.ad.core.mapper.park.apiEnterStatus">
	
	<select id="select_List" parameterType="commonMap" resultType="commonMap">
		SELECT CASE WHEN ETH.RESULT_CODE = 00 THEN '성공' ELSE '실패' END RESULT_GUBN
		     , DATE_FORMAT(ETH.REG_DT, '%Y-%m-%d %H:%i:%s') REG_DT
		     , ETH.ENTER_API_CODE, ETH.SERVICE_KEY, ETH.RESULT_CODE
	         , ETH.PARKING_AREA_CODE, ETH.CAR_NUMBER_RECV
	         , DATE_FORMAT(ETH.ENTER_DT, '%Y-%m-%d %H:%i:%s') ENTER_DT, ETH.ERR_MSG, ETH.RESULT_MSG, ETH.WALLET_FREE_YN
	         , ETH.REDUCE_CODE, ETH.REDUCE_NM, ETH.REDUCE_RATE, DATE_FORMAT(ETH.MDFCN_DT, '%Y-%m-%d %H:%i:%s') MDFCN_DT
	         , DATE_FORMAT(ETH.RECEIVE_DT, '%Y-%m-%d %H:%i:%s') RECEIVE_DT
	      FROM T_ENTER_API_HISTORY ETH
	     WHERE 1=1
		
		<if test="carNumber neq null and carNumber neq ''" >
			AND ETH.CAR_NUMBER_RECV = #{carNumber} 
		</if>
		
		<if test="kParkingNo neq null and kParkingNo neq ''">
			AND ETH.PARKING_AREA_CODE = #{kParkingNo}
		</if>
		
		<if test="kServiceKey neq null and kServiceKey neq ''">
			AND ETH.SERVICE_KEY = #{kServiceKey}
		</if>
		
		<choose>
			<when test ='kResultGubn == "Y"'>
				AND ETH.RESULT_CODE = 00
			</when>
			<when test ='kResultGubn == "N"'>
				AND ETH.RESULT_CODE != '00'
			</when>
		</choose>
  		   AND ETH.OCCUR_DT = REPLACE( #{regDt}, '-', '')
		 ORDER BY ETH.REG_DT DESC
	</select>
	
	<select id="select_parkInfo" parameterType="commonMap" resultType="commonMap">
		SELECT CONCAT(PARKING_NAME , '(' , PARKING_AREA_CODE, ')') AS TEXT
		     , PARKING_AREA_CODE VALUE
		  FROM T_PARKING_INFO
		 WHERE API_VER_GUBN = 1
		   AND USE_YN = 'Y'
	</select>
</mapper>