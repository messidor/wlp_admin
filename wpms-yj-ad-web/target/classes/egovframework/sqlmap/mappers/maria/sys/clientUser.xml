<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.yeongju.its.ad.core.mapper.sys.clientUser">

	<select id="select_list" parameterType="commonMap" resultType="commonMap">
		SELECT A.USER_ID
		     , '' AS USER_PW
		     , A.DEPT_ID
		     , A.USER_NAME
		     , A.USER_EMAIL
		     , A.DEPT_ID
		     , A.POS_GUBN
		     , A.USER_PHONE
		     , A.USE_YN
		     , B.USER_NAME AS MOD_ID
		     , DATE_FORMAT(A.MOD_DT, '%Y-%m-%d %H:%i:%s') MOD_DT
		     , A.RECV_YN
		     , 'Y' CHECK_VALUE
		     , '' STATE_COL
		  FROM T_USER_INFO A
		  LEFT OUTER JOIN T_USER_INFO B
		    ON A.MOD_ID = B.USER_ID
		 WHERE A.USER_ID NOT IN (SELECT USER_ID
                           	   	   FROM T_SYS_USER_ROLE_INFO
                           		  WHERE ROLE_ID IN ('MANAGE', 'AD'))
		 
		<if test="kSearchName neq null and kSearchName neq ''" >
			<choose>
				<when test ='kUserGubn == "A"'>
					AND A.USER_ID = #{kSearchName}
				</when>
				<when test ='kUserGubn == "B"'>
					AND A.USER_NAME = #{kSearchName}
				</when>
				<when test ='kUserGubn == "C"'>
					AND A.USER_EMAIL = #{kSearchName}
				</when>
				<when test ='kUserGubn == "D"'>
					AND A.USER_PHONE = #{kSearchName}
				</when>
				<otherwise>
					AND (A.USER_ID = #{kSearchName} OR A.USER_NAME = #{kSearchName} OR A.USER_EMAIL= #{kSearchName} OR A.USER_PHONE = #{kSearchName})
				</otherwise>
			</choose>
		</if>
		 ORDER BY A.USER_ID
	</select>
	
	<insert id="insert_user">
		INSERT INTO T_USER_INFO (
   	     	   USER_ID
   	     	 , DEPT_ID
   	     	 , POS_GUBN_PARENT
   	     	 , POS_GUBN
 	     	 , USER_PW
 	     	 , USER_NAME
 	     	 , USER_EMAIL
 	     	 , USER_PHONE
 	     	 , USE_YN_PARENT
   	     	 , USE_YN
   	     	 , REG_ID
   	     	 , REG_DT
   	     	 , MOD_ID
   	     	 , MOD_DT
   	     	 , RECV_YN_PARENT
   	     	 , RECV_YN
	  		 ) VALUES (
	  		   #{grdUserId}
	  		 , #{grdDeptId}
	         , 'POS_GUBN'
	         , #{grdPosGubn}
			 , #{grdUserPw}
 			 , #{grdUserName}
 			 , #{grdUserEmail}
 			 , #{grdUserPhone}
 			 , 'USE_YN'
 			 , #{grdUseYn}
 			 , #{userId}
 			 , NOW()
 			 , #{userId}
 			 , NOW()
 			 , 'USE_YN'
 			 , #{grdRecvYn}
			 )
	</insert>

	<update id="update_user">
		UPDATE T_USER_INFO
		   SET USER_ID = #{grdUserId}
		    <if test="grdPosGubn neq null and grdPosGubn neq ''" >
		     , POS_GUBN = #{grdPosGubn}
		    </if>
		    <if test="grdDeptId neq null and grdDeptId neq ''" >
		     , DEPT_ID = #{grdDeptId}
		    </if>
		    <if test="grdUserPw neq null and grdUserPw neq ''" >
			 , USER_PW = #{grdUserPw}
			</if>
		     , USER_NAME = #{grdUserName}
		     , USER_EMAIL = #{grdUserEmail}
		     , USER_PHONE = #{grdUserPhone}
		     , USE_YN = #{grdUseYn}
		     , MOD_ID = #{userId}
		     , MOD_DT = NOW()
		     , RECV_YN = #{grdRecvYn}
		 WHERE USER_ID = #{grdUserId}
	</update>
	
	<delete id="delete_user_role">
		DELETE FROM T_SYS_USER_ROLE_INFO
		 WHERE ROLE_ID = 'MANAGE'
		   AND USER_ID = #{grdUserId}
	</delete>
	
	<update id="delete_user">
		UPDATE T_USER_INFO
		   SET USE_YN = 'N'
		     , MOD_ID = #{userId}
		     , MOD_DT = NOW()
		 WHERE USER_ID = #{grdUserId}
	</update>
</mapper>