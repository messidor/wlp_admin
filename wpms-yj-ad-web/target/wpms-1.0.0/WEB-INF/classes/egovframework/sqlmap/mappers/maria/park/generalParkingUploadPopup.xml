<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.yeongju.its.ad.core.mapper.park.generalParkingUploadPopup">

	<!-- 주차장 ID 중복검사 -->
	<select id="select_parkingId" parameterType="commonMap" resultType="commonMap">
		SELECT COUNT(*) CNT
		  FROM T_GENERAL_PARKING_INFO
		 WHERE PARKING_ID = #{parkingId}
	</select>
	
    <!-- 공통코드 이름으로 코드 찾아오기 LIKE -->
    <select id="select_ExcelUploadGetCommonCodeLike" parameterType="commonMap" resultType="commonMap">
        SELECT CODE_ID
          FROM T_SYS_COMCODE
         WHERE PARENT_CODE_ID = #{parentCodeId}
           AND CODE_NAME1 like '%${codeName}%'
           AND USE_YN = 'Y'
    </select>

    <!-- 공통코드 이름으로 코드 찾아오기 -->
    <select id="select_ExcelUploadGetCommonCode" parameterType="commonMap" resultType="commonMap">
        SELECT CODE_ID
          FROM T_SYS_COMCODE
         WHERE PARENT_CODE_ID = #{parentCodeId}
           AND CODE_NAME1 = #{codeName}
           AND USE_YN = 'Y'
    </select>
    
    <!-- 관리기관명으로 관리기관 코드 찾아오기 -->
    <select id="select_ExcelUploadGetPGovCode" parameterType="commonMap" resultType="commonMap">
        SELECT P_GOV_CODE
          FROM T_PARKING_GOV_INFO
         WHERE P_GOV_NAME = #{pGovName}
           AND USE_YN = 'Y'
    </select>
    
    <!-- 구군-동 콤보 -->
    <select id="select_ExcelUploadGetGugunCombo" parameterType="commonMap" resultType="commonMap">
        SELECT CODE_ID AS VALUE, CODE_NAME1 AS TEXT
          FROM T_SYS_COMCODE
         WHERE PARENT_CODE_ID = #{kGugun}
           AND USE_YN = 'Y'
         ORDER BY CODE_ORDER
    </select>
    
    <!-- 관리기관 -->
    <select id="select_ExcelUploadGetGov" parameterType="commonMap" resultType="commonMap">
		SELECT P_GOV_CODE AS VALUE, P_GOV_NAME AS TEXT
		  FROM T_PARKING_GOV_INFO
		 WHERE USE_YN = 'Y'
		 ORDER BY P_GOV_CODE
    </select>

    
    <insert id="insert_ExcelUpload">
		INSERT INTO T_GENERAL_PARKING_INFO (
			   GENERAL_PARKING_NO, PARKING_ID, PARKING_NAME, PARKING_POST, PARKING_ADDR
			 , PARKING_ADDR2, PARKING_ROAD_ADDR, PARKING_ROAD_ADDR2, GUGUN_PARENT, GUGUN
			 , DONG_PARENT, DONG, PARKING_LATITUDE, PARKING_LONGITUDE, PARKING_GRADE
			 , PARKING_TEL, PARKING_SPOT, DP_PARKING_SPOT, STD_PRICE, TEN_M_PRICE
			 , MANAGE_INFO, P_GOV_CODE, MAP_MARK_GUBN_PARENT, MAP_MARK_GUBN, USE_YN_PARENT
			 , USE_YN, REG_ID, REG_DT, MOD_ID, MOD_DT
		) VALUES (
			   FN_MAKE_KEY('GENERAL_PARKING_NO'), #{grdParkingId}, #{grdParkingName}, #{grdParkingPost}, #{grdParkingAddr}
			 , #{grdParkingAddr2}, #{grdParkingRoadAddr}, #{grdParkingRoadAddr2}, 'RESION', #{grdGugun}
			 , #{grdGugun}, #{grdDong}, REPLACE(NULLIF(#{grdParkingLatitude}, ''), ',', ''), REPLACE(NULLIF(#{grdParkingLongitude}, ''), ',', ''), #{grdParkingGrade}
			 , #{grdParkingTel}, REPLACE(NULLIF(#{grdParkingSpot}, ''), ',', ''), REPLACE(NULLIF(#{grdDpParkingSpot}, ''), ',', ''), REPLACE(NULLIF(#{grdStdPrice}, ''), ',', ''), REPLACE(NULLIF(#{grdTenMprice}, ''), ',', '')
			 , #{grdManageInfo}, #{grdPGovCode}, 'MAP_MARK_GUBN', #{grdMapMarkGubn}, 'USE_YN'
			 , #{grdUseYn}, #{userId}, NOW(), #{userId}, NOW()
		)
	</insert>
</mapper>