<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.yeongju.its.ad.core.mapper.park.autopayApiStatus">
	
	<select id="select_List" parameterType="commonMap" resultType="commonMap">
		SELECT CASE WHEN A.RESULT_CODE = '1' THEN '성공' ELSE '실패' END RESULT_GUBN
			 , A.REG_API_CODE
             , DATE_FORMAT(A.API_CALL_DT, '%Y-%m-%d %H:%i:%s') API_CALL_DT
             , DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i:%s') REG_DT
             , DATE_FORMAT(A.API_RECV_DT, '%Y-%m-%d %H:%i:%s') API_RECV_DT
		     , A.RESULT_CODE
		     , A.RESULT_MSG
		     , A.ERR_MSG
		     , A.CAR_NUMBER_RECV
		     , A.WALLET_FREE_YN
		     , A.SERVICE_KEY
		     , A.PARKING_AREA_CODE
		     , DATE_FORMAT(A.ENTER_DT, '%Y-%m-%d %H:%i:%s') ENTER_DT
		     , A.REDUCE_CODE
		     , A.REDUCE_NM
		     , A.REDUCE_RATE
		     , IFNULL(A.SUCCESS_VALUE, '') AS SUCCESS_VALUE
	      FROM T_AUTOPAY_API_HISTORY A
	     WHERE 1=1
		<if test="carNumber neq null and carNumber neq ''" >
			AND A.CAR_NUMBER_RECV = #{carNumber}
		</if>
		
		<if test="kParkingNo neq null and kParkingNo neq ''">
			AND A.PARKING_AREA_CODE = #{kParkingNo}
		</if>
		
		<if test="kServiceKey neq null and kServiceKey neq ''">
			AND A.SERVICE_KEY = #{kServiceKey}
		</if>
		
		<choose>
			<when test ='kResultGubn == "Y"'>
				AND A.RESULT_CODE = '1'
			</when>
			<when test ='kResultGubn == "N"'>
				AND A.RESULT_CODE != '1'
			</when>
		</choose>
  		   AND DATE_FORMAT(A.REG_DT, '%Y%m%d') = REPLACE(#{regDt}, '-', '')
		 ORDER BY A.REG_DT DESC
	</select>
	
	<select id="select_parkInfo" parameterType="commonMap" resultType="commonMap">
		SELECT CONCAT(PARKING_NAME , '(' , PARKING_AREA_CODE, ')') AS TEXT
		     , PARKING_AREA_CODE VALUE
		  FROM T_PARKING_INFO
		 WHERE 1=1
		   AND USE_YN = 'Y'
	</select>
</mapper>